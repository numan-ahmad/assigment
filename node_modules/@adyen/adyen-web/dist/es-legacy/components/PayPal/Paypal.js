import{createElement as t}from"../../external/preact/dist/preact.js";import{UIElement as e}from"../internal/UIElement/UIElement.js";import n from"./components/PaypalComponent.js";import r from"./defaultProps.js";import{CoreProvider as i}from"../../core/Context/CoreProvider.js";import o from"../../core/Errors/AdyenCheckoutError.js";import{ERRORS as s}from"./constants.js";import{TxVariants as a}from"../tx-variants.js";import{formatPaypalOrderContactToAdyenFormat as p}from"./utils/format-paypal-order-contact-to-adyen-format.js";function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){h(t,e,n[e])}))}return t}function d(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e.push.apply(e,n)}return e}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}function u(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}class c extends e{formatProps(t){var e,n,r;const i=null===(e=t.configuration)||void 0===e?void 0:e.merchantId,o=null===(n=t.configuration)||void 0===n?void 0:n.intent,s=0===(null===(r=t.amount)||void 0===r?void 0:r.value)?"tokenize":t.intent||o,a="tokenize"===s||t.vault,p="continue"===t.userAction;return d(l({},t),{commit:!p&&t.commit,vault:a,configuration:{intent:s,merchantId:i}})}submitAnalytics(t){super.submitAnalytics(l({},t),this.props)}updatePaymentData(t){t||console.warn("PayPal - Updating payment data with an invalid value"),this.paymentData=t}formatData(){const{isExpress:t,userAction:e}=this.props;return{paymentMethod:{type:c.type,userAction:e,subtype:t?"express":c.subtype}}}get isValid(){return!0}handleResolve(t){if(!this.resolve)return this.handleError(new o("ERROR",s.WRONG_INSTANCE));this.resolve(t)}handleReject(t){if(!this.reject)return this.handleError(new o("ERROR",s.WRONG_INSTANCE));this.reject(new Error(t))}handleSubmit(){return super.submit(),new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}handleOnShippingAddressChange(t,e){return this.props.onShippingAddressChange(t,e,this)}handleOnShippingOptionsChange(t,e){return this.props.onShippingOptionsChange(t,e,this)}render(){if(!this.props.showPayButton)return null;const e=this.props,{onShippingAddressChange:r,onShippingOptionsChange:s}=e,a=u(e,["onShippingAddressChange","onShippingOptionsChange"]);return t(i,{i18n:this.props.i18n,loadingContext:this.props.loadingContext,resources:this.resources},t(n,d(l({ref:t=>{this.componentRef=t}},a,r&&{onShippingAddressChange:this.handleOnShippingAddressChange},s&&{onShippingOptionsChange:this.handleOnShippingOptionsChange}),{onCancel:()=>this.handleError(new o("CANCEL")),onChange:this.setState,onApprove:this.handleOnApprove,onError:t=>{this.handleError(new o("ERROR",t.toString(),{cause:t}))},onScriptLoadFailure:t=>this.handleError(t),onSubmit:this.handleSubmit})))}constructor(t,e){super(t,e),h(this,"paymentData",null),h(this,"resolve",null),h(this,"reject",null),h(this,"submit",(()=>{this.handleError(new o("IMPLEMENTATION_ERROR",s.SUBMIT_NOT_SUPPORTED))})),h(this,"handleAction",(t=>this.updateWithAction(t))),h(this,"updateWithAction",(t=>{if(t.paymentMethodType!==this.type)throw new Error("Invalid Action");return t.paymentData&&(this.paymentData=t.paymentData),t.sdkData&&t.sdkData.token?(this.onActionHandled({componentType:this.type,actionDescription:"sdk-loaded",originalAction:t}),this.handleResolve(t.sdkData.token)):this.handleReject(s.NO_TOKEN_PROVIDED),null})),h(this,"handleOnApprove",((t,e)=>{const{onAuthorized:n}=this.props,r={data:{details:t,paymentData:this.paymentData}};if(n)return e.order.get().then((t=>{var e;const r=p(null==t?void 0:t.payer),i=p(null==t||null===(e=t.purchase_units)||void 0===e?void 0:e[0].shipping,!0);return this.setState(l({authorizedEvent:t},r&&{billingAddress:r},i&&{deliveryAddress:i})),new Promise(((e,o)=>n(l({authorizedEvent:t},r&&{billingAddress:r},i&&{deliveryAddress:i}),{resolve:e,reject:o})))})).then((()=>this.handleAdditionalDetails(r))).catch((t=>this.handleError(new o("ERROR","Something went wrong while parsing PayPal Order",{cause:t}))));this.handleAdditionalDetails(r)})),this.handleSubmit=this.handleSubmit.bind(this),this.handleOnShippingAddressChange=this.handleOnShippingAddressChange.bind(this),this.handleOnShippingOptionsChange=this.handleOnShippingOptionsChange.bind(this)}}h(c,"type",a.paypal),h(c,"subtype","sdk"),h(c,"defaultProps",r);export{c as default};
//# sourceMappingURL=Paypal.js.map
