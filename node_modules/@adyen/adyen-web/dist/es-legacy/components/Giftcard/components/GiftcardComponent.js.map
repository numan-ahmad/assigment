{"version":3,"file":"GiftcardComponent.js","sources":["../../../../../src/components/Giftcard/components/GiftcardComponent.tsx"],"sourcesContent":["import { Component, FunctionComponent, h } from 'preact';\nimport SecuredFieldsProvider from '../../internal/SecuredFields/SFP/SecuredFieldsProvider';\nimport Alert from '../../internal/Alert';\nimport GiftcardResult from './GiftcardResult';\nimport { useCoreContext } from '../../../core/Context/CoreProvider';\nimport { PaymentAmount } from '../../../types/global-types';\nimport { GIFT_CARD } from '../../internal/SecuredFields/lib/constants';\nimport { GiftCardFields } from './GiftcardFields';\nimport { GiftcardFieldsProps, Placeholders } from './types';\n\ninterface GiftcardComponentProps {\n    onChange: (state) => void;\n    onFocus: (event) => void;\n    onBlur: (event) => void;\n    onSubmit: (event) => void;\n    onBalanceCheck: (event) => void;\n\n    amount?: PaymentAmount;\n    showPayButton: boolean;\n    payButton: (config) => any;\n\n    pinRequired: boolean;\n    expiryDateRequired?: boolean;\n    fieldsLayoutComponent: FunctionComponent<GiftcardFieldsProps>;\n    placeholders?: Placeholders;\n    handleKeyPress?: (o: KeyboardEvent) => void;\n}\n\nclass Giftcard extends Component<GiftcardComponentProps> {\n    public state = {\n        status: 'ready',\n        data: {},\n        balance: null,\n        transactionLimit: null,\n        focusedElement: false,\n        isValid: false\n    };\n\n    public static defaultProps = {\n        pinRequired: true,\n        expiryDateRequired: false,\n        onChange: () => {},\n        onFocus: () => {},\n        onBlur: () => {},\n        fieldsLayoutComponent: GiftCardFields\n    };\n\n    public sfp;\n\n    public onChange = sfpState => {\n        this.props.onChange({\n            data: sfpState.data,\n            isValid: sfpState.isSfpValid\n        });\n    };\n\n    public showValidation = () => {\n        this.sfp.showValidation();\n    };\n\n    setStatus(status) {\n        this.setState({ status });\n    }\n\n    public handleFocus = e => {\n        this.setState({ focusedElement: e.currentFocusObject });\n\n        const isFocused = e.focus === true;\n        if (isFocused) {\n            this.props.onFocus(e);\n        } else {\n            this.props.onBlur(e);\n        }\n    };\n\n    public setBalance = ({ balance, transactionLimit }) => {\n        this.setState({ balance, transactionLimit });\n    };\n\n    render(props, { focusedElement, balance, transactionLimit }) {\n        const { i18n } = useCoreContext();\n\n        const transactionAmount = transactionLimit?.value < balance?.value ? transactionLimit : balance;\n        const hasEnoughBalance = transactionAmount?.value >= this.props.amount?.value;\n\n        if (transactionAmount && hasEnoughBalance) {\n            return <GiftcardResult balance={balance} transactionLimit={transactionLimit} onSubmit={props.onSubmit} {...props} />;\n        }\n\n        const getCardErrorMessage = sfpState => {\n            if (sfpState.errors.encryptedCardNumber) return i18n.get(sfpState.errors.encryptedCardNumber);\n\n            switch (this.state.status) {\n                case 'no-balance':\n                    return i18n.get('error.giftcard.no-balance');\n                case 'card-error':\n                    return i18n.get('error.giftcard.card-error');\n                case 'currency-error':\n                    return i18n.get('error.giftcard.currency-error');\n                default:\n                    return null;\n            }\n        };\n\n        return (\n            <div className=\"adyen-checkout__giftcard\">\n                {this.state.status === 'error' && <Alert icon={'cross'}>{i18n.get('error.message.unknown')}</Alert>}\n\n                <SecuredFieldsProvider\n                    {...this.props}\n                    ref={ref => {\n                        this.sfp = ref;\n                    }}\n                    onChange={this.onChange}\n                    onFocus={this.handleFocus}\n                    type={GIFT_CARD}\n                    render={({ setRootNode, setFocusOn }, sfpState) =>\n                        this.props.fieldsLayoutComponent({\n                            i18n: i18n,\n                            pinRequired: this.props.pinRequired,\n                            focusedElement: focusedElement,\n                            getCardErrorMessage: getCardErrorMessage,\n                            setRootNode: setRootNode,\n                            setFocusOn: setFocusOn,\n                            sfpState: sfpState\n                        })\n                    }\n                />\n\n                {this.props.showPayButton &&\n                    this.props.payButton({\n                        status: this.state.status,\n                        onClick: this.props.onSubmit,\n                        label: i18n.get('applyGiftcard')\n                    })}\n            </div>\n        );\n    }\n}\n\nexport default Giftcard;\n"],"names":["Giftcard","Component","setStatus","status","this","setState","render","props","focusedElement","balance","transactionLimit","_this_props_amount","i18n","useCoreContext","transactionAmount","value","hasEnoughBalance","amount","h","GiftcardResult","onSubmit","getCardErrorMessage","sfpState","errors","encryptedCardNumber","get","state","div","className","Alert","icon","SecuredFieldsProvider","_object_spread_props","_object_spread","ref","sfp","onChange","onFocus","handleFocus","type","GIFT_CARD","setRootNode","setFocusOn","fieldsLayoutComponent","pinRequired","showPayButton","payButton","onClick","label","super","args","_define_property","data","isValid","isSfpValid","showValidation","e","currentFocusObject","focus","onBlur","setBalance","defaultProps","expiryDateRequired","GiftCardFields"],"mappings":"quCA4BA,MAAMA,UAAiBC,EAgCnBC,SAAAA,CAAUC,GACNC,KAAKC,SAAS,CAAEF,UACpB,CAiBAG,MAAAA,CAAOC,GAAOC,eAAEA,EAAcC,QAAEA,EAAOC,iBAAEA,IAIgB,IAAAC,EAHrD,MAAMC,KAAEA,GAASC,IAEXC,GAAoBJ,aAAAA,EAAAA,EAAkBK,QAAQN,aAAAA,EAAAA,EAASM,OAAQL,EAAmBD,EAClFO,GAAmBF,aAAAA,EAAAA,EAAmBC,SAAS,QAAAJ,EAAAP,KAAKG,MAAMU,cAAX,IAAAN,OAAA,EAAAA,EAAmBI,OAExE,GAAID,GAAqBE,EACrB,OAAOE,EAACC,EAAAA,EAAAA,CAAeV,QAASA,EAASC,iBAAkBA,EAAkBU,SAAUb,EAAMa,UAAcb,IAG/G,MAAMc,EAAsBC,IACxB,GAAIA,EAASC,OAAOC,oBAAqB,OAAOZ,EAAKa,IAAIH,EAASC,OAAOC,qBAEzE,OAAQpB,KAAKsB,MAAMvB,QACf,IAAK,aACD,OAAOS,EAAKa,IAAI,6BACpB,IAAK,aACD,OAAOb,EAAKa,IAAI,6BACpB,IAAK,iBACD,OAAOb,EAAKa,IAAI,iCACpB,QACI,OAAO,KACf,EAGJ,OACIP,EAACS,MAAAA,CAAIC,UAAU,4BACY,UAAtBxB,KAAKsB,MAAMvB,QAAsBe,EAACW,EAAAA,CAAMC,KAAM,SAAUlB,EAAKa,IAAI,0BAElEP,EAACa,EACOC,EAAAC,EAAA,CAAA,EAAA7B,KAAKG,OAAK,CACd2B,IAAKA,IACD9B,KAAK+B,IAAMD,CAAAA,EAEfE,SAAUhC,KAAKgC,SACfC,QAASjC,KAAKkC,YACdC,KAAMC,EACNlC,OAAQ,EAAGmC,cAAaC,cAAcpB,IAClClB,KAAKG,MAAMoC,sBAAsB,CAC7B/B,KAAMA,EACNgC,YAAaxC,KAAKG,MAAMqC,YACxBpC,eAAgBA,EAChBa,oBAAqBA,EACrBoB,YAAaA,EACbC,WAAYA,EACZpB,SAAUA,OAKrBlB,KAAKG,MAAMsC,eACRzC,KAAKG,MAAMuC,UAAU,CACjB3C,OAAQC,KAAKsB,MAAMvB,OACnB4C,QAAS3C,KAAKG,MAAMa,SACpB4B,MAAOpC,EAAKa,IAAI,mBAIpC,mBA5GAwB,SAAAC,GAAAC,EAAA/C,KAAOsB,QAAQ,CACXvB,OAAQ,QACRiD,KAAM,CAAC,EACP3C,QAAS,KACTC,iBAAkB,KAClBF,gBAAgB,EAChB6C,SAAS,IAYbF,OAAOhB,WAAP,GAEAgB,EAAA/C,KAAOgC,YAAWd,IACdlB,KAAKG,MAAM6B,SAAS,CAChBgB,KAAM9B,EAAS8B,KACfC,QAAS/B,EAASgC,YACtB,IAGJH,OAAOI,kBAAiB,KACpBnD,KAAK+B,IAAIoB,gBAAc,IAO3BJ,EAAA/C,KAAOkC,eAAckB,IACjBpD,KAAKC,SAAS,CAAEG,eAAgBgD,EAAEC,sBAEJ,IAAZD,EAAEE,MAEhBtD,KAAKG,MAAM8B,QAAQmB,GAEnBpD,KAAKG,MAAMoD,OAAOH,EACtB,IAGJL,OAAOS,cAAa,EAAGnD,UAASC,uBAC5BN,KAAKC,SAAS,CAAEI,UAASC,oBAAiB,KAtC9CyC,EAVEnD,EAUY6D,eAAe,CACzBjB,aAAa,EACbkB,oBAAoB,EACpB1B,SAAU,OACVC,QAAS,OACTsB,OAAQ,OACRhB,sBAAuBoB"}