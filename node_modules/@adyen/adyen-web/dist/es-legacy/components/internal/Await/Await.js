import{createElement as e}from"../../../external/preact/dist/preact.js";import{useState as t,useEffect as a}from"../../../external/preact/hooks/dist/hooks.js";import o from"../../../external/classnames/index.js";import r from"../../../core/Services/payment-status.js";import{processResponse as n}from"../../../core/ProcessResponse/process-response.js";import s from"../Spinner/Spinner.js";import i from"../Countdown/index.js";import c from"../Button/Button.js";import{useCoreContext as l}from"../../../core/Context/CoreProvider.js";import u from"../../../core/Errors/AdyenCheckoutError.js";import d from"../ContentSeparator/ContentSeparator.js";import m from"../../../core/Context/useImage.js";function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},o=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),o.forEach((function(t){p(e,t,a[t])}))}return e}function y(e,t){if(null==e)return{};var a,o,r=function(e,t){if(null==e)return{};var a,o,r={},n=Object.keys(e);for(o=0;o<n.length;o++)a=n[o],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(o=0;o<n.length;o++)a=n[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function f(p){const{i18n:f,loadingContext:h}=l(),w=m(),[g,b]=t(!1),[k,v]=t(!1),[j,N]=t(!0),[O,C]=t(!1),[x,T]=t(p.delay),[E,R]=t(100),[P,S]=t(0),[D,A]=t(!1),[I,L]=t(null),M=e=>{if(e.props.payload){b(!0);const t={data:{details:{payload:e.props.payload},paymentData:p.paymentData}};return p.onComplete(t,this)}v(!0),p.onError(new u("ERROR","successful result, but no payload in response"))},$=e=>{if(v(!0),e.props.payload){const t={data:{details:{payload:e.props.payload},paymentData:p.paymentData}};return p.onComplete(t,this)}p.onError(new u("ERROR","error result with no payload in response"))},z=()=>{const{paymentData:e,clientKey:t,throttleInterval:a}=p;var o;O||(null===(o=p.onActionHandled)||void 0===o||o.call(p,{componentType:p.type,actionDescription:"polling-started"}),C(!0));r(e,t,h,a).then(n).catch((e=>{var{message:t}=e,a=y(e,["message"]);return{type:"network-error",props:_({},t&&{message:f.get(t)},a)}})).then((e=>{switch(e.type){case"success":M(e);break;case"error":$(e);break;default:N(!1)}}))},B=e=>{window.location.assign(e)};a((()=>{p.shouldRedirectAutomatically&&p.url&&B(p.url)}),[p.shouldRedirectAutomatically,p.url]),a((()=>(z(),()=>{clearTimeout(I)})),[]),a((()=>{if(k)return clearTimeout(I);if(g)return clearTimeout(I);if(!j){L(setTimeout((()=>{z();const e=P+x;S(e),e>=p.throttleTime&&!D&&(T(p.throttleInterval),A(!0))}),x))}}),[j,k,g,P]);const F=(t,a)=>e("div",{className:"adyen-checkout__await adyen-checkout__await--result"},e("img",{className:"adyen-checkout__await__icon adyen-checkout__await__icon--result",src:w({imageFolder:"components/"})(t),alt:f.get(a)}),e("div",{className:"adyen-checkout__await__subtitle adyen-checkout__await__subtitle--result"},f.get(a)));if(k)return F("error","error.subtitle.payment");if(g)return F("success","creditCard.success");if(j)return e("div",{className:"adyen-checkout__await"},p.brandLogo&&e("img",{src:p.brandLogo,alt:p.type,className:"adyen-checkout__await__brand-logo"}),e(s,{inline:!1,size:"large"}));const H=f.get("wechatpay.timetopay").split("%@");return e("div",{className:o("adyen-checkout__await",`adyen-checkout__await--${p.type}`,p.classNameModifiers.map((e=>`adyen-checkout__await--${e}`)))},p.brandLogo&&e("img",{src:p.brandLogo,alt:p.type,className:"adyen-checkout__await__brand-logo"}),e("div",{className:"adyen-checkout__await__subtitle"},p.messageText),e("div",{className:"adyen-checkout__await__indicator-holder"},e("div",{className:"adyen-checkout__await__indicator-spinner"},e(s,{inline:!1,size:"medium"})),e("div",{className:"adyen-checkout__await__indicator-text"},p.awaitText)),p.showCountdownTimer&&e("div",{className:"adyen-checkout__await__countdown-holder"},e("div",{className:"adyen-checkout__await__progress"},e("span",{className:"adyen-checkout__await__percentage",style:{width:`${E}%`}})),e("div",{className:"adyen-checkout__await__countdown"},H[0]," ",e(i,{minutesFromNow:p.countdownTime,onTick:e=>{R(e.percentage)},onCompleted:()=>{v(!0),clearTimeout(I),p.onError(new u("ERROR","Payment Expired"))}})," ",H[1])),p.url&&!p.shouldRedirectAutomatically&&e("div",{className:"adyen-checkout__await__app-link"},e(d,null),e(c,{classNameModifiers:["await"],onClick:()=>B(p.url),label:f.get("openApp")})))}f.defaultProps={countdownTime:15,onError:()=>{},onComplete:()=>{},delay:2e3,throttleTime:6e4,throttleInterval:1e4,showCountdownTimer:!0,classNameModifiers:[],url:null};export{f as default};
//# sourceMappingURL=Await.js.map
