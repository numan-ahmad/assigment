{"version":3,"file":"CustomCard.js","sources":["../../../../src/components/CustomCard/CustomCard.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement';\nimport CustomCardInput from './CustomCardInput';\nimport { CoreProvider } from '../../core/Context/CoreProvider';\nimport collectBrowserInfo from '../../utils/browserInfo';\nimport triggerBinLookUp from '../internal/SecuredFields/binLookup/triggerBinLookUp';\nimport { CbObjOnBinLookup, CbObjOnFocus } from '../internal/SecuredFields/lib/types';\nimport { BrandObject } from '../Card/types';\nimport { getCardImageUrl, fieldTypeToSnakeCase } from '../internal/SecuredFields/utils';\nimport { TxVariants } from '../tx-variants';\nimport { CustomCardConfiguration } from './types';\nimport { ANALYTICS_FOCUS_STR, ANALYTICS_UNFOCUS_STR } from '../../core/Analytics/constants';\nimport { SendAnalyticsObject } from '../../core/Analytics/types';\n\n// TODO questions about\n// brand - does a merchant ever make a custom stored card?\n// type\n// countryCode\n\nexport class CustomCard extends UIElement<CustomCardConfiguration> {\n    public static type = TxVariants.customCard;\n\n    public static analyticsType = 'custom-scheme';\n\n    protected static defaultProps = {\n        onBinLookup: () => {},\n        brandsConfiguration: {}\n    };\n\n    formatProps(props: CustomCardConfiguration) {\n        return {\n            ...props,\n            type: TxVariants.customCard,\n            brand: TxVariants.card\n        };\n    }\n\n    /**\n     * Formats the component data output\n     */\n    formatData() {\n        const sfBrand = this.state.selectedBrandValue;\n        return {\n            paymentMethod: {\n                type: 'scheme',\n                ...this.state.data,\n                ...(sfBrand && { brand: sfBrand })\n            },\n            browserInfo: this.browserInfo,\n            origin: !!window && window.location.origin\n        };\n    }\n\n    protected submitAnalytics(analyticsObj: SendAnalyticsObject) {\n        super.submitAnalytics(analyticsObj, this.props);\n    }\n\n    updateStyles(stylesObj) {\n        if (this.componentRef?.updateStyles) this.componentRef.updateStyles(stylesObj);\n        return this;\n    }\n\n    setFocusOn(frame) {\n        if (this.componentRef?.setFocusOn) this.componentRef.setFocusOn(frame);\n        return this;\n    }\n\n    processBinLookupResponse(binLookupResponse) {\n        if (this.componentRef?.processBinLookupResponse) this.componentRef.processBinLookupResponse(binLookupResponse);\n        return this;\n    }\n\n    dualBrandingChangeHandler(e: Event | string) {\n        if (this.componentRef?.dualBrandingChangeHandler) this.componentRef.dualBrandingChangeHandler(e);\n        return this;\n    }\n\n    handleUnsupportedCard(errObj) {\n        if (this.componentRef?.handleUnsupportedCard) this.componentRef.handleUnsupportedCard(errObj);\n        return this;\n    }\n\n    onBinLookup(obj: CbObjOnBinLookup) {\n        const nuObj = { ...obj };\n        nuObj.rootNode = this._node;\n\n        if (!nuObj.isReset) {\n            // Add brandImage urls, first checking if the merchant has configured their own one for the brand\n            nuObj.supportedBrandsRaw = obj.supportedBrandsRaw?.map((item: BrandObject) => {\n                item.brandImageUrl = this.props.brandsConfiguration[item.brand]?.icon ?? getCardImageUrl(item.brand, this.resources);\n                return item;\n            });\n        }\n\n        this.props.onBinLookup(nuObj);\n    }\n\n    public onBinValue = triggerBinLookUp(this);\n\n    get isValid() {\n        return !!this.state.isValid;\n    }\n\n    get browserInfo() {\n        return collectBrowserInfo();\n    }\n\n    private onFocus = (obj: CbObjOnFocus) => {\n        this.submitAnalytics({\n            type: obj.focus === true ? ANALYTICS_FOCUS_STR : ANALYTICS_UNFOCUS_STR,\n            target: fieldTypeToSnakeCase(obj.fieldType)\n        });\n\n        // Call merchant defined callback\n        this.props.onFocus?.(obj);\n    };\n\n    protected onEnterKeyPressed = (activeElement: Element, component: UIElement) => {\n        this.props.onEnterKeyPressed?.(activeElement, component);\n    };\n\n    render() {\n        return (\n            <CoreProvider i18n={this.props.i18n} loadingContext={this.props.loadingContext} resources={this.resources}>\n                <CustomCardInput\n                    ref={ref => {\n                        this.componentRef = ref;\n                    }}\n                    {...this.props}\n                    {...this.state}\n                    handleKeyPress={this.handleKeyPress}\n                    rootNode={this._node}\n                    onChange={this.setState}\n                    onBinValue={this.onBinValue}\n                    implementationType={'custom'}\n                    resources={this.resources}\n                    brand={this.props.brand}\n                    onFocus={this.onFocus}\n                />\n            </CoreProvider>\n        );\n    }\n}\n\nexport default CustomCard;\n"],"names":["CustomCard","UIElement","formatProps","props","_object_spread_props","type","TxVariants","customCard","brand","card","formatData","sfBrand","this","state","selectedBrandValue","paymentMethod","_object_spread","data","browserInfo","origin","window","location","submitAnalytics","analyticsObj","super","updateStyles","stylesObj","_this_componentRef","componentRef","setFocusOn","frame","processBinLookupResponse","binLookupResponse","dualBrandingChangeHandler","e","handleUnsupportedCard","errObj","onBinLookup","obj","nuObj","rootNode","_node","isReset","supportedBrandsRaw","map","item","_this_props_brandsConfiguration_item_brand","_this_props_brandsConfiguration_item_brand_icon","brandImageUrl","brandsConfiguration","icon","getCardImageUrl","resources","isValid","collectBrowserInfo","render","h","CoreProvider","i18n","loadingContext","CustomCardInput","ref","handleKeyPress","onChange","setState","onBinValue","implementationType","onFocus","args","_define_property","triggerBinLookUp","_this_props_onFocus","_this_props","focus","ANALYTICS_FOCUS_STR","ANALYTICS_UNFOCUS_STR","target","fieldTypeToSnakeCase","fieldType","call","onEnterKeyPressed","activeElement","component","_this_props_onEnterKeyPressed","analyticsType","defaultProps"],"mappings":"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"}