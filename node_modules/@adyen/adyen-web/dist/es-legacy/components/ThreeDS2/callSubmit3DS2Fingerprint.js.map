{"version":3,"file":"callSubmit3DS2Fingerprint.js","sources":["../../../../src/components/ThreeDS2/callSubmit3DS2Fingerprint.ts"],"sourcesContent":["import { httpPost } from '../../core/Services/http';\nimport { pick } from '../../utils/commonUtils';\nimport { ThreeDS2FingerprintResponse } from './types';\nimport AdyenCheckoutError from '../../core/Errors/AdyenCheckoutError';\nimport { THREEDS2_ERROR, THREEDS2_FINGERPRINT_SUBMIT } from './constants';\nimport { ANALYTICS_ERROR_TYPE, Analytics3DS2Errors } from '../../core/Analytics/constants';\nimport { SendAnalyticsObject } from '../../core/Analytics/types';\n\n/**\n * ThreeDS2DeviceFingerprint, onComplete, calls a new, internal, endpoint which\n * behaves like the /details endpoint but doesn't require the same credentials\n */\nexport default function callSubmit3DS2Fingerprint({ data }): void {\n    httpPost<ThreeDS2FingerprintResponse>(\n        {\n            path: `v1/submitThreeDS2Fingerprint?token=${this.props.clientKey}`,\n            loadingContext: this.props.loadingContext,\n            errorLevel: 'fatal'\n        },\n        {\n            ...data\n        }\n    )\n        .then(resData => {\n            let analyticsErrorObject: SendAnalyticsObject;\n\n            /**\n             * Frictionless (no challenge) flow OR \"refused\" flow\n             */\n            if (resData.type === 'completed') {\n                const { details } = resData;\n\n                if (!resData.details) {\n                    console.debug(\n                        'Handled Error::callSubmit3DS2Fingerprint::FAILED:: no details object in a response indicating either a \"frictionless\" flow, or a \"refused\" response. resData=',\n                        resData\n                    );\n\n                    analyticsErrorObject = {\n                        type: THREEDS2_ERROR,\n                        code: Analytics3DS2Errors.NO_DETAILS_FOR_FRICTIONLESS_OR_REFUSED,\n                        errorType: ANALYTICS_ERROR_TYPE.apiError,\n                        message: `${THREEDS2_FINGERPRINT_SUBMIT}: no details object in a response indicating either a \"frictionless\" flow, or a \"refused\" response`\n                    };\n\n                    this.submitAnalytics(analyticsErrorObject);\n                    return;\n                }\n\n                return this.onComplete({ data: { details } });\n            }\n\n            /**\n             * If we don't have a type: \"completed\", then we expect an action, because we must be in a Challenge or Redirect flow\n             */\n            if (!resData.action) {\n                console.debug(\n                    'Handled Error::callSubmit3DS2Fingerprint::FAILED:: no action object in a response indicating a \"challenge\". resData=',\n                    resData\n                );\n\n                analyticsErrorObject = {\n                    type: THREEDS2_ERROR,\n                    code: Analytics3DS2Errors.NO_ACTION_FOR_CHALLENGE,\n                    errorType: ANALYTICS_ERROR_TYPE.apiError,\n                    message: `${THREEDS2_FINGERPRINT_SUBMIT}: no action object in a response indicating a \"challenge\" flow`\n                };\n                this.submitAnalytics(analyticsErrorObject);\n                return;\n            }\n\n            // elementRef exists when the fingerprint component is created from the Dropin\n            const actionHandler = this.props.elementRef ?? this;\n\n            /**\n             * We have an action but do we have a way to handle it?\n             * TODO - check logs: do we ever *not* have an actionHandler?\n             */\n            if (!actionHandler) {\n                console.debug('Handled Error::callSubmit3DS2Fingerprint::FAILED:: no actionHandler');\n\n                analyticsErrorObject = {\n                    type: THREEDS2_ERROR,\n                    code: Analytics3DS2Errors.NO_COMPONENT_FOR_ACTION,\n                    errorType: ANALYTICS_ERROR_TYPE.sdkError,\n                    message: `${THREEDS2_FINGERPRINT_SUBMIT}: no component defined to handle the action response`\n                };\n                this.submitAnalytics(analyticsErrorObject);\n                return;\n            }\n\n            /**\n             * Challenge flow\n             */\n            if (resData.action?.type === 'threeDS2') {\n                // Ensure challengeWindowSize is propagated if there was a (merchant defined) handleAction call proceeding this one that had it set as an option\n                return actionHandler.handleAction(resData.action, pick('challengeWindowSize').from(this.props));\n            }\n\n            /**\n             * Redirect flow (usecase: we thought we could do 3DS2 but it turns out we can't)\n             * TODO - check logs: does this ever happen, anymore?\n             */\n            if (resData.action?.type === 'redirect') {\n                return actionHandler.handleAction(resData.action);\n            }\n        })\n        .catch((error: AdyenCheckoutError) => {\n            this.handleError(error);\n        });\n}\n"],"names":["callSubmit3DS2Fingerprint","data","httpPost","path","this","props","clientKey","loadingContext","errorLevel","_object_spread","then","resData","analyticsErrorObject","type","details","onComplete","console","debug","THREEDS2_ERROR","code","Analytics3DS2Errors","NO_DETAILS_FOR_FRICTIONLESS_OR_REFUSED","errorType","ANALYTICS_ERROR_TYPE","apiError","message","THREEDS2_FINGERPRINT_SUBMIT","submitAnalytics","action","NO_ACTION_FOR_CHALLENGE","_this_props_elementRef","actionHandler","elementRef","handleAction","pick","from","NO_COMPONENT_FOR_ACTION","sdkError","catch","error","handleError"],"mappings":"oZAYe,SAASA,GAA0BC,KAAEA,IAChDC,EACI,CACIC,KAAM,sCAAsCC,KAAKC,MAAMC,YACvDC,eAAgBH,KAAKC,MAAME,eAC3BC,WAAY,+UAEhBC,CACOR,CAAAA,EAAAA,IAGNS,MAAKC,QAuEEA,EASAA,EA/EJ,IAAIC,EAKJ,GAAqB,cAAjBD,EAAQE,KAAsB,CAC9B,MAAMC,QAAEA,GAAYH,EAEpB,OAAKA,EAAQG,QAiBNV,KAAKW,WAAW,CAAEd,KAAM,CAAEa,cAhB7BE,QAAQC,MACJ,gKACAN,GAGJC,EAAuB,CACnBC,KAAMK,EACNC,KAAMC,EAAoBC,uCAC1BC,UAAWC,EAAqBC,SAChCC,QAAS,GAAGC,4GAGhBtB,KAAKuB,gBAAgBf,GAK7B,CAKA,IAAKD,EAAQiB,OAaT,OAZAZ,QAAQC,MACJ,uHACAN,GAGJC,EAAuB,CACnBC,KAAMK,EACNC,KAAMC,EAAoBS,wBAC1BP,UAAWC,EAAqBC,SAChCC,QAAS,GAAGC,wEAEhBtB,KAAKuB,gBAAgBf,GAKH,IAAAkB,EAAtB,MAAMC,EAAqC,QAArBD,EAAA1B,KAAKC,MAAM2B,kBAAX,IAAAF,EAAAA,EAAyB1B,KAM/C,OAAK2B,EAgBwB,sBAAzBpB,EAAAA,EAAQiB,cAARjB,IAAAA,OAAAA,EAAAA,EAAgBE,MAETkB,EAAcE,aAAatB,EAAQiB,OAAQM,EAAK,uBAAuBC,KAAK/B,KAAKC,QAO/D,sBAAzBM,EAAAA,EAAQiB,cAARjB,IAAAA,OAAAA,EAAAA,EAAgBE,MACTkB,EAAcE,aAAatB,EAAQiB,aAD9C,GAxBIZ,QAAQC,MAAM,uEAEdL,EAAuB,CACnBC,KAAMK,EACNC,KAAMC,EAAoBgB,wBAC1Bd,UAAWC,EAAqBc,SAChCZ,QAAS,GAAGC,8DAEhBtB,KAAKuB,gBAAgBf,GAkBzB,IAEH0B,OAAOC,IACJnC,KAAKoC,YAAYD,EAAAA,GAE7B"}