{"version":3,"file":"CustomCardInput.js","sources":["../../../../../src/components/CustomCard/CustomCardInput/CustomCardInput.tsx"],"sourcesContent":["import { h } from 'preact';\nimport { useState, useEffect, useRef, useMemo } from 'preact/hooks';\nimport Language from '../../../language/Language';\nimport SecuredFieldsProvider from '../../internal/SecuredFields/SFP/SecuredFieldsProvider';\nimport { SFPState } from '../../internal/SecuredFields/SFP/types';\nimport { BinLookupResponse, CardBrandsConfiguration } from '../../Card/types';\nimport SFExtensions from '../../internal/SecuredFields/binLookup/extensions';\nimport { StylesObject } from '../../internal/SecuredFields/lib/types';\nimport { Resources } from '../../../core/Context/Resources';\nimport { Placeholders, SFError } from '../../Card/components/CardInput/types';\nimport { ValidationError } from '../types';\n\ninterface SecuredFieldsProps {\n    autoFocus?: boolean;\n    brand?: string;\n    brands?: string[];\n    brandsConfiguration?: CardBrandsConfiguration;\n    clientKey?: string;\n    countryCode?: string;\n    i18n: Language;\n    implementationType?: string;\n    keypadFix?: boolean;\n    loadingContext?: string;\n    legacyInputMode?: boolean;\n    minimumExpiryDate?: string;\n    onAdditionalSFConfig?: () => {};\n    onAdditionalSFRemoved?: () => {};\n    onAllValid?: () => {};\n    onAutoComplete?: () => {};\n    onBinValue?: () => {};\n    onBrand?: () => {};\n    onConfigSuccess?: () => {};\n    onChange: (data) => void;\n    handleKeyPress?: (obj: KeyboardEvent) => void;\n    onError?: () => {};\n    onFieldValid?: () => {};\n    onFocus?: (e) => {};\n    onLoad?: () => {};\n    placeholders?: Placeholders;\n    rootNode: HTMLElement;\n    resources: Resources;\n    showWarnings?: boolean;\n    styles?: StylesObject;\n    trimTrailingSeparator?: boolean;\n    type: string;\n    maskSecurityCode?: boolean;\n}\n\nconst defaultProps = {\n    onChange: () => {},\n    onError: () => {},\n    onValidationError: () => {}\n};\n\nfunction CustomCardInput(props: SecuredFieldsProps) {\n    const sfp = useRef(null);\n\n    const [errors, setErrors] = useState({});\n    const [valid, setValid] = useState({});\n    const [data, setData] = useState({});\n\n    const [isSfpValid, setIsSfpValid] = useState(false);\n\n    const [issuingCountryCode, setIssuingCountryCode] = useState(null);\n\n    const [dualBrandSelectElements, setDualBrandSelectElements] = useState([]);\n    const [selectedBrandValue, setSelectedBrandValue] = useState('');\n\n    const handleSecuredFieldsChange = (sfState: SFPState): void => {\n        setData({ ...data, ...sfState.data });\n        setErrors({ ...errors, ...sfState.errors });\n        setValid({ ...valid, ...sfState.valid });\n\n        setIsSfpValid(sfState.isSfpValid);\n    };\n\n    // Farm the handlers for binLookup related functionality out to another 'extensions' file\n    const extensions = useMemo(\n        () =>\n            SFExtensions(\n                props,\n                { sfp },\n                { dualBrandSelectElements, setDualBrandSelectElements, setSelectedBrandValue, issuingCountryCode, setIssuingCountryCode }\n            ),\n        [dualBrandSelectElements, issuingCountryCode]\n    );\n\n    /**\n     * EXPECTED METHODS ON SecuredFields.this\n     */\n    this.processBinLookupResponse = (binLookupResponse: BinLookupResponse, isReset: boolean) => {\n        extensions.processBinLookup(binLookupResponse, isReset);\n    };\n\n    this.dualBrandingChangeHandler = extensions.handleDualBrandSelection;\n\n    /**\n     * EFFECT HOOKS\n     */\n    useEffect(() => {\n        // componentDidMount\n        this.setFocusOn = sfp.current.setFocusOn;\n        this.updateStyles = sfp.current.updateStyles;\n        this.showValidation = sfp.current.showValidation;\n        this.handleUnsupportedCard = sfp.current.handleUnsupportedCard;\n\n        // componentWillUnmount\n        return () => {\n            sfp.current.destroy();\n        };\n    }, []);\n\n    /**\n     * Main 'componentDidUpdate' handler\n     */\n    useEffect(() => {\n        const sfStateErrorsObj = sfp.current.mapErrorsToValidationRuleResult();\n\n        const mappedErrors = { ...errors, ...sfStateErrorsObj }; // maps sfErrors\n\n        props.onChange({\n            data,\n            valid,\n            errors: mappedErrors,\n            isValid: isSfpValid,\n            selectedBrandValue\n        });\n\n        // Create an array of Validation error objects and send to callback\n        if (Object.keys(mappedErrors).length) {\n            const validationErrors: ValidationError[] = Object.entries(mappedErrors).map(([fieldType, error]) => {\n                const valErr: ValidationError = {\n                    fieldType,\n                    ...(error ? (error as SFError) : { error: '', rootNode: this.props.rootNode })\n                };\n                return valErr;\n            });\n            this.props.onValidationError?.(validationErrors);\n        }\n    }, [data, valid, errors, selectedBrandValue]);\n\n    /**\n     * RENDER\n     */\n    // prettier-ignore\n    return (\n        <SecuredFieldsProvider\n            ref={sfp}\n            {...extractPropsForSFP(props)}\n            type={props.brand}\n            onChange={handleSecuredFieldsChange}\n            render={() => null}\n        />\n    );\n}\n\nCustomCardInput.defaultProps = defaultProps;\n\nexport default CustomCardInput;\n\nconst extractPropsForSFP = (props: SecuredFieldsProps) => {\n    return {\n        autoFocus: props.autoFocus,\n        brands: props.brands,\n        brandsConfiguration: props.brandsConfiguration,\n        clientKey: props.clientKey,\n        // countryCode: props.countryCode, // only used for korean cards when koreanAuthenticationRequired is true\n        i18n: props.i18n,\n        implementationType: props.implementationType,\n        keypadFix: props.keypadFix,\n        legacyInputMode: props.legacyInputMode,\n        loadingContext: props.loadingContext,\n        minimumExpiryDate: props.minimumExpiryDate,\n        onAdditionalSFConfig: props.onAdditionalSFConfig,\n        onAdditionalSFRemoved: props.onAdditionalSFRemoved,\n        onAllValid: props.onAllValid,\n        onAutoComplete: props.onAutoComplete,\n        onBinValue: props.onBinValue,\n        onBrand: props.onBrand,\n        // onChange // set directly\n        onConfigSuccess: props.onConfigSuccess,\n        handleKeyPress: props.handleKeyPress,\n        onError: props.onError,\n        onFieldValid: props.onFieldValid,\n        onFocus: props.onFocus,\n        onLoad: props.onLoad,\n        // render // set directly\n        rootNode: props.rootNode,\n        showWarnings: props.showWarnings,\n        styles: props.styles,\n        trimTrailingSeparator: props.trimTrailingSeparator,\n        resources: props.resources,\n        maskSecurityCode: props.maskSecurityCode,\n        placeholders: props.placeholders\n    };\n};\n"],"names":["CustomCardInput","props","sfp","useRef","errors","setErrors","useState","valid","setValid","data","setData","isSfpValid","setIsSfpValid","issuingCountryCode","setIssuingCountryCode","dualBrandSelectElements","setDualBrandSelectElements","selectedBrandValue","setSelectedBrandValue","extensions","useMemo","SFExtensions","this","processBinLookupResponse","binLookupResponse","isReset","processBinLookup","dualBrandingChangeHandler","handleDualBrandSelection","useEffect","setFocusOn","current","updateStyles","showValidation","handleUnsupportedCard","destroy","sfStateErrorsObj","mapErrorsToValidationRuleResult","mappedErrors","onChange","isValid","Object","keys","length","validationErrors","entries","map","fieldType","error","rootNode","onValidationError","h","SecuredFieldsProvider","ref","extractPropsForSFP","type","brand","sfState","render","defaultProps","onError","autoFocus","brands","brandsConfiguration","clientKey","i18n","implementationType","keypadFix","legacyInputMode","loadingContext","minimumExpiryDate","onAdditionalSFConfig","onAdditionalSFRemoved","onAllValid","onAutoComplete","onBinValue","onBrand","onConfigSuccess","handleKeyPress","onFieldValid","onFocus","onLoad","showWarnings","styles","trimTrailingSeparator","resources","maskSecurityCode","placeholders"],"mappings":"qUAsDA,SAASA,EAAgBC,GACrB,MAAMC,EAAMC,EAAO,OAEZC,EAAQC,GAAaC,EAAS,CAAC,IAC/BC,EAAOC,GAAYF,EAAS,CAAC,IAC7BG,EAAMC,GAAWJ,EAAS,CAAC,IAE3BK,EAAYC,GAAiBN,GAAS,IAEtCO,EAAoBC,GAAyBR,EAAS,OAEtDS,EAAyBC,GAA8BV,EAAS,KAChEW,EAAoBC,GAAyBZ,EAAS,IAWvDa,EAAaC,GACf,IACIC,EACIpB,EACA,CAAEC,OACF,CAAEa,0BAAyBC,6BAA4BE,wBAAuBL,qBAAoBC,2BAE1G,CAACC,EAAyBF,IA6D9B,OAvDAS,KAAKC,yBAA2B,CAACC,EAAsCC,KACnEN,EAAWO,iBAAiBF,EAAmBC,EAAAA,EAGnDH,KAAKK,0BAA4BR,EAAWS,yBAK5CC,GAAU,KAENP,KAAKQ,WAAa5B,EAAI6B,QAAQD,WAC9BR,KAAKU,aAAe9B,EAAI6B,QAAQC,aAChCV,KAAKW,eAAiB/B,EAAI6B,QAAQE,eAClCX,KAAKY,sBAAwBhC,EAAI6B,QAAQG,sBAGlC,KACHhC,EAAI6B,QAAQI,SAAO,IAExB,IAKHN,GAAU,KACN,MAAMO,EAAmBlC,EAAI6B,QAAQM,kCAE/BC,EAAe,IAAKlC,KAAWgC,GAWrC,GATAnC,EAAMsC,SAAS,CACX9B,OACAF,QACAH,OAAQkC,EACRE,QAAS7B,EACTM,uBAIAwB,OAAOC,KAAKJ,GAAcK,OAAQ,CAClC,MAAMC,EAAsCH,OAAOI,QAAQP,GAAcQ,KAAI,EAAEC,EAAWC,MACtD,CAC5BD,eACIC,GAA6B,CAAEA,MAAO,GAAIC,SAAU3B,KAAKrB,MAAMgD,cAI3E3B,KAAKrB,MAAMiD,oBAAoBN,EACnC,IACD,CAACnC,EAAMF,EAAOH,EAAQa,IAOrBkC,EAACC,EAAAA,CACGC,IAAKnD,KACDoD,EAAmBrD,GACvBsD,KAAMtD,EAAMuD,MACZjB,SAlF2BkB,IAC/B/C,EAAQ,IAAKD,KAASgD,EAAQhD,OAC9BJ,EAAU,IAAKD,KAAWqD,EAAQrD,SAClCI,EAAS,IAAKD,KAAUkD,EAAQlD,QAEhCK,EAAc6C,EAAQ9C,WAAU,EA8E5B+C,OAAQ,IAAM,MAG1B,CAEA1D,EAAgB2D,aA5GK,CACjBpB,SAAU,OACVqB,QAAS,OACTV,kBAAmB,QA6GvB,MAAMI,EAAsBrD,IACjB,CACH4D,UAAW5D,EAAM4D,UACjBC,OAAQ7D,EAAM6D,OACdC,oBAAqB9D,EAAM8D,oBAC3BC,UAAW/D,EAAM+D,UAEjBC,KAAMhE,EAAMgE,KACZC,mBAAoBjE,EAAMiE,mBAC1BC,UAAWlE,EAAMkE,UACjBC,gBAAiBnE,EAAMmE,gBACvBC,eAAgBpE,EAAMoE,eACtBC,kBAAmBrE,EAAMqE,kBACzBC,qBAAsBtE,EAAMsE,qBAC5BC,sBAAuBvE,EAAMuE,sBAC7BC,WAAYxE,EAAMwE,WAClBC,eAAgBzE,EAAMyE,eACtBC,WAAY1E,EAAM0E,WAClBC,QAAS3E,EAAM2E,QAEfC,gBAAiB5E,EAAM4E,gBACvBC,eAAgB7E,EAAM6E,eACtBlB,QAAS3D,EAAM2D,QACfmB,aAAc9E,EAAM8E,aACpBC,QAAS/E,EAAM+E,QACfC,OAAQhF,EAAMgF,OAEdhC,SAAUhD,EAAMgD,SAChBiC,aAAcjF,EAAMiF,aACpBC,OAAQlF,EAAMkF,OACdC,sBAAuBnF,EAAMmF,sBAC7BC,UAAWpF,EAAMoF,UACjBC,iBAAkBrF,EAAMqF,iBACxBC,aAActF,EAAMsF"}