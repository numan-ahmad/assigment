{"version":3,"file":"ThreeDS2DeviceFingerprint.js","sources":["../../../../src/components/ThreeDS2/ThreeDS2DeviceFingerprint.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport PrepareFingerprint from './components/DeviceFingerprint';\nimport callSubmit3DS2Fingerprint from './callSubmit3DS2Fingerprint';\nimport { existy } from '../../utils/commonUtils';\nimport { TxVariants } from '../tx-variants';\nimport { ThreeDS2DeviceFingerprintConfiguration } from './types';\nimport AdyenCheckoutError, { API_ERROR } from '../../core/Errors/AdyenCheckoutError';\nimport { ANALYTICS_ERROR_TYPE, Analytics3DS2Errors, ANALYTICS_RENDERED_STR, Analytics3DS2Events } from '../../core/Analytics/constants';\nimport { SendAnalyticsObject } from '../../core/Analytics/types';\nimport { THREEDS2_ERROR, THREEDS2_FINGERPRINT, THREEDS2_FINGERPRINT_ERROR, THREEDS2_FULL } from './constants';\nimport { ActionHandledReturnObject } from '../../types/global-types';\n\nclass ThreeDS2DeviceFingerprint extends UIElement<ThreeDS2DeviceFingerprintConfiguration> {\n    public static type = TxVariants.threeDS2Fingerprint;\n\n    public static defaultProps = {\n        dataKey: 'fingerprintResult',\n        type: THREEDS2_FINGERPRINT\n    };\n\n    private callSubmit3DS2Fingerprint = callSubmit3DS2Fingerprint.bind(this); // New 3DS2 flow\n\n    protected submitAnalytics = (aObj: SendAnalyticsObject) => {\n        if (aObj.type === ANALYTICS_RENDERED_STR) return; // suppress the rendered event (it will have the same timestamp as the \"threeDSMethodData sent\" event)\n\n        super.submitAnalytics(aObj);\n    };\n\n    protected onActionHandled = (rtnObj: ActionHandledReturnObject) => {\n        this.submitAnalytics({\n            type: THREEDS2_FULL,\n            message: rtnObj.actionDescription,\n            subtype: Analytics3DS2Events.FINGERPRINT_IFRAME_LOADED\n        });\n        super.onActionHandled(rtnObj);\n    };\n\n    onComplete(state) {\n        super.onComplete(state);\n        this.unmount(); // re. fixing issue around back to back fingerprinting calls\n    }\n\n    render() {\n        /**\n         * In the regular components (aka \"native\") flow we can't proceed because something has gone wrong with the payment if paymentData is missing from the threeDS2 action.\n         * In the MDFlow the paymentData is always present (albeit an empty string, which is why we use 'existy' since we should be allowed to proceed with this)\n         */\n        if (!existy(this.props.paymentData)) {\n            this.props.onError(new AdyenCheckoutError(API_ERROR, `No paymentData received. 3DS2 Fingerprint cannot proceed`));\n\n            // TODO - check logs to see if this *ever* happens\n            this.submitAnalytics({\n                type: THREEDS2_ERROR,\n                code: Analytics3DS2Errors.ACTION_IS_MISSING_PAYMENT_DATA,\n                errorType: ANALYTICS_ERROR_TYPE.apiError,\n                message: `${THREEDS2_FINGERPRINT_ERROR}: Missing 'paymentData' property from threeDS2 action`\n            });\n\n            return null;\n        }\n\n        /**\n         * this.props.isMDFlow indicates the action to create this component came from the 3DS2InMDFlow process and upon completion should call the\n         * passed onComplete callback (as defined in the 3DS2InMDFlow) instead of the /submitThreeDS2Fingerprint endpoint for the regular, \"native\" flow\n         */\n        return (\n            <PrepareFingerprint\n                {...this.props}\n                onComplete={this.props.isMDFlow ? this.onComplete : this.callSubmit3DS2Fingerprint}\n                onSubmitAnalytics={this.submitAnalytics}\n                isMDFlow={this.props.paymentData.length < 15}\n                onActionHandled={this.onActionHandled}\n            />\n        );\n    }\n}\n\nexport default ThreeDS2DeviceFingerprint;\n"],"names":["ThreeDS2DeviceFingerprint","UIElement","onComplete","state","super","this","unmount","render","existy","props","paymentData","h","PrepareFingerprint","isMDFlow","callSubmit3DS2Fingerprint","onSubmitAnalytics","submitAnalytics","length","onActionHandled","onError","AdyenCheckoutError","API_ERROR","type","THREEDS2_ERROR","code","Analytics3DS2Errors","ACTION_IS_MISSING_PAYMENT_DATA","errorType","ANALYTICS_ERROR_TYPE","apiError","message","THREEDS2_FINGERPRINT_ERROR","args","_define_property","bind","aObj","ANALYTICS_RENDERED_STR","rtnObj","THREEDS2_FULL","actionDescription","subtype","Analytics3DS2Events","FINGERPRINT_IFRAME_LOADED","TxVariants","threeDS2Fingerprint","defaultProps","dataKey","THREEDS2_FINGERPRINT"],"mappings":"gzBAaA,MAAMA,UAAkCC,EAyBpCC,UAAAA,CAAWC,GACPC,MAAMF,WAAWC,GACjBE,KAAKC,SACT,CAEAC,MAAAA,GAKI,OAAKC,EAAOH,KAAKI,MAAMC,aAmBnBC,EAACC,EAAAA,IACOP,KAAKI,MACTP,WAAYG,KAAKI,MAAMI,SAAWR,KAAKH,WAAaG,KAAKS,0BACzDC,kBAAmBV,KAAKW,gBACxBH,SAAUR,KAAKI,MAAMC,YAAYO,OAAS,GAC1CC,gBAAiBb,KAAKa,mBAvB1Bb,KAAKI,MAAMU,QAAQ,IAAIC,EAAmBC,EAAW,6DAGrDhB,KAAKW,gBAAgB,CACjBM,KAAMC,EACNC,KAAMC,EAAoBC,+BAC1BC,UAAWC,EAAqBC,SAChCC,QAAS,GAAGC,2DAGT,KAgBf,mBAtDA3B,SAAA4B,GAAAC,EAAA5B,KAAQS,4BAA4BA,EAA0BoB,KAAK7B,OAEnE4B,EAAA5B,KAAUW,mBAAmBmB,IACrBA,EAAKb,OAASc,GAElBhC,MAAMY,gBAAgBmB,EAAAA,IAG1BF,EAAA5B,KAAUa,mBAAmBmB,IACzBhC,KAAKW,gBAAgB,CACjBM,KAAMgB,EACNR,QAASO,EAAOE,kBAChBC,QAASC,EAAoBC,4BAEjCtC,MAAMc,gBAAgBmB,EAAAA,KArB1BJ,EADEjC,EACYsB,OAAOqB,EAAWC,qBAEhCX,EAHEjC,EAGY6C,eAAe,CACzBC,QAAS,oBACTxB,KAAMyB"}