import{createElement as e}from"../../../external/preact/dist/preact.js";import{useRef as s,useState as r,useEffect as o}from"../../../external/preact/hooks/dist/hooks.js";import{useCoreContext as i}from"../../../core/Context/CoreProvider.js";import n from"../CompanyDetails/CompanyDetails.js";import t from"../PersonalDetails/PersonalDetails.js";import a from"../Address/Address.js";import l from"../FormFields/Checkbox/Checkbox.js";import d from"../FormFields/ConsentCheckbox/ConsentCheckbox.js";import{getInitialActiveFieldsets as c,fieldsetsSchema as m,getActiveFieldsData as p}from"./utils.js";import b from"../IbanInput/IbanInput.js";import u from"../FormFields/Field/Field.js";import y from"../FormInstruction/FormInstruction.js";import C from"./useSRPanelForOpenInvoiceErrors.js";const h={isValid:!1,errorMessage:"consent.checkbox.invalid",error:"consent.checkbox.invalid"};function f(f){const{countryCode:A,visibility:v}=f,{i18n:k}=i(),g=s({});Object.keys(g.current).length||f.setComponentRef?.(g.current);const D=s(!1),x=c(v,f.data),[F,j]=r(x),{current:w}=s(m.reduce(((e,s)=>(e[s]=e=>{w[s].current=e},e)),{})),R=!!f.consentCheckboxLabel,E=!R&&Object.keys(F).every((e=>!F[e])),I="editable"===v.deliveryAddress&&"hidden"!==v.billingAddress,[S,q]=r({...f.data,...R&&{consentCheckbox:!1}}),[P,V]=r({}),[M,N]=r({}),[O,L]=r("ready");g.current.showValidation=()=>{D.current=!0,m.forEach((e=>{w[e].current&&w[e].current.showValidation()})),V({...R&&{consentCheckbox:S.consentCheckbox?null:h}})},g.current.setStatus=L,C({errors:P,data:S,props:f,isValidating:D}),o((()=>{const e=Object.keys(F).every((e=>!F[e]||!!M[e])),s=!R||!!M.consentCheckbox,r=e&&s,o=p(F,S);f.onChange({data:o,errors:P,valid:M,isValid:r})}),[S,F]);const B=e=>s=>{q((r=>({...r,[e]:s.data}))),N((r=>({...r,[e]:s.isValid}))),V((r=>({...r,[e]:s.errors})))};return e("div",{className:"adyen-checkout__open-invoice"},e(y,null),F.companyDetails&&e(n,{data:f.data.companyDetails,label:"companyDetails",onChange:B("companyDetails"),setComponentRef:w.companyDetails,visibility:v.companyDetails}),F.personalDetails&&e(t,{data:f.data.personalDetails,requiredFields:f.personalDetailsRequiredFields,label:"personalDetails",onChange:B("personalDetails"),setComponentRef:w.personalDetails,visibility:v.personalDetails}),F.bankAccount&&e(b,{holderName:!0,label:"ach.bankAccount",data:S.bankAccount,onChange:B("bankAccount"),ref:w.bankAccount}),F.billingAddress&&e(a,{allowedCountries:f?.billingAddressSpecification?.allowedCountries??f.allowedCountries,countryCode:A,requiredFields:f.billingAddressRequiredFields,specifications:f.billingAddressSpecification,data:S.billingAddress,label:"billingAddress",onChange:B("billingAddress"),setComponentRef:w.billingAddress,visibility:v.billingAddress}),I&&e(u,{classNameModifiers:["separateDeliveryAddress","consentCheckbox"],name:"separateDeliveryAddress",useLabelElement:!1,showErrorElement:!1},e(l,{label:k.get("separateDeliveryAddress"),checked:F.deliveryAddress,classNameModifiers:["separateDeliveryAddress"],name:"separateDeliveryAddress",onChange:()=>{j((e=>({...e,deliveryAddress:!F.deliveryAddress})))}})),F.deliveryAddress&&e(a,{allowedCountries:f?.deliveryAddressSpecification?.allowedCountries??f.allowedCountries,countryCode:A,requiredFields:f.deliveryAddressRequiredFields,specifications:f.deliveryAddressSpecification,data:S.deliveryAddress,label:"deliveryAddress",onChange:B("deliveryAddress"),setComponentRef:w.deliveryAddress,visibility:v.deliveryAddress}),R&&e(d,{data:S,errorMessage:!!P.consentCheckbox,label:f.consentCheckboxLabel,onChange:e=>{const{checked:s}=e.target;q((e=>({...e,consentCheckbox:s}))),N((e=>({...e,consentCheckbox:s}))),V((e=>({...e,consentCheckbox:s?null:h})))},i18n:k}),f.showPayButton&&f.payButton({status:O,classNameModifiers:[...E?["standalone"]:[]],label:k.get("confirmPurchase")}))}export{f as default};
//# sourceMappingURL=OpenInvoice.js.map
